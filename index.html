<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8">
    <title>miniSHA256.js</title>
    <link rel="stylesheet" href="utils/base.css">
    <style>
      @import url('https://fonts.googleapis.com/css?family=Ubuntu:300');
      body, button, input, textarea, select, th, td, h1, h2, h3, h4, h5, h6{
        font-family: 'Ubuntu', sans-serif;
      }
    </style>
  </head>
  <body>
    <h1>miniSHA256.js</h1>
    <p><a href="https://github.com/tomaslangkaas/miniSHA256.js/blob/gh-pages/README.md">GitHub repository</a></p>
    <p><button onclick="runTests(logResult)">Run tests</button></p>
    <p id="results"></p>
    <script src="src/miniSHA256.js"></script>
    <script src="utils/bico.js"></script>
    <script src="test/sha-256-test-vectors.js"></script>
    <script type="text/javascript">
      bico(bico, 'fromBits', 'toBits', '01', 1);

      function runTests(report){
        var vectors = SHA256TestVectors,
        set = vectors['set 1'],
        i, result, pass = 0, total = 0,
        message = [],
        failed = [],
        date = +new Date;
        function assert(actual, expected, failMessage){
          total++;
          if('' + actual === '' + expected){
            pass++;
          }else{
            failed.push(failMessage, actual, expected);
          }
        }
        //set 1, vectors #0-#7
        for(i = 0; i < 8; i++){
          result = miniSHA256().digest(
            set[i].message,
            set[i].messageLength
          );
          assert(result, set[i].hash);
        }
        report(pass, total, (+new Date) - date);
        //set 2, 1024 vectors
        set = vectors['set 2'];
        for(i = 0; i < set.length/8; i++){
          result = miniSHA256()
            .digest(message, i);
          assert(result, set.slice(i * 8, i * 8 + 8));
        }
        report(pass, total, (+new Date) - date);
        //set 3, 512 vectors
        set = vectors['set 3'];
        for(i = 0; i < set.length/8; i++){
          //place 1 at bit position i in 512 bit array
          message[i >>> 5] = 1 << (31 - (i & 31));
          result = miniSHA256().digest(message, 512);
          //reset bit position to 0
          message[i >>> 5] = 0;
          assert(result, set.slice(i * 8, i * 8 + 8));
        }
        report(pass, total, (+new Date) - date);
      }

      function logResult(pass, total, time){
        document.getElementById('results').innerHTML = 'Passed ' + pass + ' of ' + total + ' tests, ' + time + ' ms';
      }
    </script>
  </body>
</html>
